<!DOCTYPE html>
<html>
<head>
  <title>Upload PDF ke Apps Script</title>
</head>
<body>
  <h2>Upload Dokumen PDF</h2>
  <form id="uploadForm">
    <label>Pilih file PDF:</label><br>
    <input type="file" id="fileInput" accept="application/pdf" required><br><br>

    <label>Kategori:</label><br>
    <select id="kategori" required>
      <option value="">-- Pilih --</option>
      <option value="Audit">Audit</option>
      <option value="Reviu">Reviu</option>
      <option value="Evaluasi">Evaluasi</option>
      <option value="Lainnya">Lainnya</option>
    </select><br><br>

    <label>Tahun:</label><br>
    <input type="text" id="tahun" placeholder="Misalnya: 2024"><br><br>

    <button type="submit">Upload</button>
    <p id="status"></p>
  </form>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbxCIpqRm7MwJzNeczD9dUUMRLANpiE1Pbez5MoV8WCJ_EeRkYb0LZkY5x5E_XFHXKo/exec";

    document.getElementById("uploadForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const file = document.getElementById("fileInput").files[0];
      const kategori = document.getElementById("kategori").value;
      const tahun = document.getElementById("tahun").value;
      const status = document.getElementById("status");

      if (!file || !kategori) {
        status.innerText = "Lengkapi form terlebih dahulu.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function() {
        const base64Data = reader.result.split(',')[1]; // Buang header base64

        const formData = new URLSearchParams();
        formData.append("file", base64Data);
        formData.append("filename", file.name);
        formData.append("kategori", kategori);
        formData.append("tahun", tahun);

        fetch(scriptUrl, {
          method: "POST",
          body: formData
        })
        .then(res => res.text())
        .then(msg => {
          status.innerText = msg;
          document.getElementById("uploadForm").reset();
        })
        .catch(err => {
          status.innerText = "Gagal upload: " + err.message;
        });
      };

      reader.readAsDataURL(file); // Encode ke base64
      status.innerText = "Mengupload...";
    });
  </script>
</body>
</html>
